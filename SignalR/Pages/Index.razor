@page "/"
@inject IJSRuntime JsRuntime
@inject IZonkClient ZonkClient
@inject NavigationManager NavManager

<PageTitle>Zonk</PageTitle>

@if (!String.IsNullOrEmpty(Name))
{
    <h1>Your nickname: @Name</h1>

    <button @onclick="StartGame">Start game</button>

}

@code {
    public string Name;

    protected async Task StartGame()
    {
        var response = await ZonkClient.InitializeGame(Name);

        if (!response.IsSuccess)
        {
            await JsRuntime.InvokeVoidAsync("alert", response.Error.Message);
        }

        NavManager.NavigateTo("games/" + response.Data.GameId);
    }

    protected override async Task OnInitializedAsync()
    {
        Name = await JsRuntime.InvokeAsync<string>("localStorage.getItem", "name");
        if (String.IsNullOrEmpty(Name))
        {
            Login();
        }
    }

    protected async void Login()
    {
        Name = await JsRuntime.InvokeAsync<string>("prompt", "Enter your nickname:");
        await JsRuntime.InvokeAsync<string>("localStorage.setItem", "name", Name);
        StateHasChanged();
    }
}